<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>单词拼写</title>
    <style>
        /* 保持原有样式不变，新增输入提示样式 */
        #inputDisplay.correct { color: #2ecc71; }
        #inputDisplay.wrong { color: #e74c3c; }
    </style>
</head>
<body>
    <!-- 保持原有HTML结构不变 -->

    <script>
        // 修改后的核心逻辑
        function handleKeyPress(e) {
            const display = document.getElementById('inputDisplay');
            
            // 处理特殊按键
            if (e.key === 'Enter') {
                checkAnswer();
                return;
            }
            if (e.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
                display.textContent = userInput;
                return;
            }

            // 严格过滤输入（仅允许字母）
            if (e.key.length === 1 && e.key.match(/^[a-zA-Z]$/)) {
                userInput += e.key.toLowerCase();
                display.textContent = userInput;
            }
        }

        function checkAnswer() {
            const display = document.getElementById('inputDisplay');
            const currentWord = currentTest[currentIndex];
            const correct = currentWord.word.toLowerCase();
            const isCorrect = userInput === correct;

            // 显示正确答案（错误时）
            if (!isCorrect) {
                display.classList.add('wrong');
                display.textContent = correct; // 显示正确答案
                display.title = `你的输入：${userInput}`; // 鼠标悬停显示用户输入
            } else {
                display.classList.add('correct');
            }

            setTimeout(() => {
                display.classList.remove('correct', 'wrong');
                display.title = '';

                if (isCorrect) {
                    handleCorrectAnswer(currentWord);
                } else {
                    handleWrongAnswer(currentWord);
                }

                proceedToNext();
            }, 1200); // 延长显示时间
        }

        function handleCorrectAnswer(word) {
            stats.right++;
            if (!correctWords.includes(word.word)) {
                correctWords.push(word.word);
                localStorage.setItem('correctWords', JSON.stringify(correctWords));
            }
            currentIndex++;
        }

        function handleWrongAnswer(word) {
            stats.wrong++;
            // 将错词添加到队列末尾（确保不会重复添加）
            if (!wrongWords.some(w => w.word === word.word)) {
                wrongWords.push(word);
                currentTest.push(JSON.parse(JSON.stringify(word))); // 深拷贝避免污染原数据
            }
        }

        function proceedToNext() {
            updateStats();
            
            if (currentIndex < currentTest.length) {
                showNextWord();
            } else if (wrongWords.length > 0) {
                // 开始重试错词
                currentTest = [...wrongWords];
                currentIndex = 0;
                wrongWords = [];
                document.getElementById('totalTestCount').textContent = currentTest.length;
                showNextWord();
            } else {
                showFinalResult();
                document.removeEventListener('keydown', handleKeyPress);
            }
        }

        // 初始化部分保持不变，注意更新totalTestCount显示
        function startTest() {
            // ...其他初始化代码...
            document.getElementById('totalTestCount').textContent = currentTest.length;
        }
    </script>
</body>
</html>
